# js-rakuten-order
日用品を楽天で検索してカートに入れる

# 機能概要

1. Google スプレッドシートで作成しておいた買い物リストを開く。
1. 楽天市場にログインする。
1. 買い物リストから、チェックが入っているものを読み取る。
1. 楽天市場のお気に入りリストを開き、メモ欄のテキストと買い物リストのテキストが一致するものを探す。
1. 一致するものが見つかった場合、商品をカートに入れる。
1. カートに入れることができたものは、買い物リストのチェックマークを外す。

このスクリプトでは、商品をカートに入れるが注文はしない。カートの内容の確認や数量の調整などをしたあと、自分で決済する必要がある。
楽天の場合、ログインしてからカートへの追加をすればブラウザを閉じてもカートの情報が保存されるため、スクリプト実行後に自分で楽天市場へアクセスし、上記の流れで作業することが可能。

# 準備

## 買い物リストを作る
Google スプレッドシートで買い物リストを作っておく。チェックリスト形式にして、買いたいものにチェックを入れる方式で運用する。
作成したら、このスプレッドシートのIDを取得してconfigファイルに書いておく。スプレッドシートIDは、アドレスバーからコピーできる。

## お気に入りリストを作る
楽天市場でお気に入りリストを作っておく。消耗品用リストを作り、商品をお気に入りに登録したら、メモ欄に買い物リストと同じ名前を付けて、買い物リストと商品を結びつける。

![](doc/image-02.png)

複数の商品を一つの買い物リストに結びつけることが可能。その場合、上から順番にカートに入れられるかどうかを試し、成功したらそこで終了する。
これによって、1つ目の商品が品切れだった場合に、代替の商品をカートに入れることができる。

# 設定ファイル

```default.json
{
    "rakuten" : {
        "user_id" : ""
        , "password" : ""
        , "bookmark" : {
            "url" : "https://my.bookmark.rakuten.co.jp/item/xxxx"
        }
    }
    , "spreadsheet" : {
         "id" : "スプレッドシートのID"
        , "todo" : {
            "sheetName":"買い物リスト"
            ,"range":"A2:B"
        }
    }
    , "chrome" : {
        "executablePath" : "C:/Program Files (x86)/Google/Chrome/Application/chrome.exe"
    }
}
```

# 買い物リストがGoogle スプレッドシートである理由
リストをあらかじめ作成しておき、必要なものにチェックマークを付ける方式で運用したかったため。
Googleであれば、Keepに似たような機能があるが、KeepにはAPIが存在しない。それではとpuppeteerでアクセスも試したが、botと感知されるせいかログインができなかったため、不採用とした。
そのほかのサービスについては、このためだけに会員登録することは避けたかったため試行さえもしていない。
